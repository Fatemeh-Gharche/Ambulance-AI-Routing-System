# Ambulance-AI Project Documentation

## 1. ساختار کلی پروژه

این پروژه شامل سه سناریوی اصلی برای مسیریابی آمبولانس‌ها در یک نقشه‌ی شهری است. ساختار پروژه مطابق پوشه‌ای است که در تصویر مشاهده می‌شود و شامل فایل‌های زیر است:

### **فایل‌ها:**

* **map_loader.py** — مسئول بارگذاری نقشه و استخراج موقعیت‌ها
* **search_utils.py** — شامل توابع کمکی، هزینه‌ها، هیوریستیک و تعریف State
* **scenario1_uninformed.py** — پیاده‌سازی الگوریتم UCS برای سناریوی تک‌هدفه
* **scenario2_astar.py** — پیاده‌سازی A* برای سناریوی چندهدفه
* **scenario2_log.txt** — فایل لاگ برای نمایش گره‌های expand شده در A*
* **scenario1_log.txt** — فایل لاگ برای نمایش گره‌های expand شده در UCS
* **scenario3_genetic.py** — پیاده‌سازی الگوریتم ژنتیک برای تخصیص چند آمبولانس به چند حادثه
* **LICENSE**, **README.md**, **.gitignore** — فایل‌های جانبی پروژه
* ****pycache**/** — فایل‌های کامپایل‌شده پایتون (غیرضروری)

صفحه ورودی شامل شاخهٔ اصلی با تمام سناریوها است که به صورت مستقل اجرا می‌شوند.

---

## 2. map_loader.py – بارگذاری نقشه و استخراج موقعیت‌ها

این ماژول مسئول دریافت ورودی از کاربر یا فایل است و داده‌ها را تبدیل به یک ماتریس (grid) می‌کند.

### توابع اصلی:

#### **load_map()**

* ورودی: تعداد سطر و ستون
* سپس خواندن هر سطر نقشه
* خروجی: `(rows, cols, grid)`

#### **find_positions(grid)**

* یک شروع **S** و چندین هدف **G** را در نقشه پیدا می‌کند.
* برای سناریوهای تک‌ آمبولانسی استفاده می‌شود.

#### **find_positions_multi(grid)**

* چند موقعیت شروع **S** و چند هدف **G** را استخراج می‌کند.
* مخصوص سناریوی ۳ (Multi-Ambulance)

این ماژول فقط کار data-loading انجام می‌دهد و هیچ عملکرد الگوریتمی ندارد.

---

## 3. search_utils.py – توابع کمکی و ساختار State

### **ساختار State**

هر حالت شامل:

* **position:** مختصات فعلی
* **visited_goals:** هدف‌هایی که تاکنون ویزیت شده‌اند
* **path:** ترتیب اکشن‌ها
* **cost:** هزینه تجمعی طی‌شده

### **توابع مهم:**

#### **step_cost(cell, time_so_far)**

* هزینه ورود به هر سلول را بر اساس نوع آن محاسبه می‌کند:

  * عددی → همان عدد
  * 'S' و 'G' → یک واحد
  * 'L' → چراغ راهنمایی با چرخه‌ی ۲۰ ثانیه:

    * ۰–۹ → سبز → هزینه ۱
    * ۱۰–۱۹ → قرمز → توقف تا سبز شدن
  * سایر (مانع) → هزینه بسیار زیاد

#### **heuristic_mst(...)**

هیوریستیک MST برای مسیریابی چندهدفه:

* فاصله تا نزدیک‌ترین هدف باقی‌مانده +
* هزینه Minimum Spanning Tree بین اهداف باقیمانده

این هیوریستیک **سازگار** است و برای A* مناسب است.

---

## 4. سناریوی ۱ – Uniform Cost Search (UCS)

فایل: **scenario1_uninformed.py**

### هدف:

* یافتن کم‌هزینه‌ترین مسیر از S به تمام Gها بدون استفاده از هیوریستیک‌ها

### مکانیزم:

* استفاده از **priority queue** بر اساس g(n)
* مدیریت زمان چراغ‌ها با اضافه کردن STAY
* حالت‌ها با کلید `(pos, visited_goals, time_mod)` ذخیره می‌شوند

### خروجی:

* مسیر اکشن‌ها
* هزینه نهایی
* تعداد حالت‌های expand شده

UCS تضمین می‌کند کم‌هزینه‌ترین مسیر را پیدا کند اما ممکن است گره‌های زیادی expand کند.

---

## 5. سناریوی ۲ – A* با هیوریستیک MST

فایل: **scenario2_astar.py**

### هدف:

کمینه‌سازی هزینه پیمایش از S به همه Gها با استفاده از هیوریستیک قوی.

### ویژگی‌ها:

* استفاده از **heuristic_mst** برای کمینه‌سازی تخمین هزینه
* ثبت لاگ در فایل `scenario2_log.txt`
* مشخص کردن visited با مجموعه و جلوگیری از چرخه‌ها

### مزایا:

* A* نسبت به UCS بسیار کمتر expand می‌کند
* هیوریستیک MST جستجو را بسیار سریع‌تر می‌سازد

---

## 6. سناریوی ۳ – Genetic Algorithm برای چند آمبولانس

فایل: **scenario3_genetic.py**

### هدف:

* تخصیص بهینه بین **چندین آمبولانس** و **چند حادثه** (Multi-target, Multi-agent)

### ایده اصلی:

* هر کروموزوم نشان می‌دهد هر حادثه به کدام آمبولانس اختصاص یافته
* تابع Fitness = زمان بیشترین آمبولانس (makespan)
* استفاده از **A* چندهدفه** برای مسیر هر آمبولانس
* استفاده از **مریم کاری/کراس اور یکنواخت/جهش**
* توقف هنگام بدون پیشرفت بودن ۸۰ نسل

### ساختار کروموزوم:

```
[index_of_ambulance for each_incident]
```

مثال:
برای ۳ حادثه و ۲ آمبولانس:

```
[0, 1, 0]
```

به معنی:

* حادثه ۱ → آمبولانس ۱
* حادثه ۲ → آمبولانس ۲
* حادثه ۳ → آمبولانس ۱

### خروجی:

* بهترین assignment
* زمان طی مسیر هر آمبولانس
* مقدار makespan
* مختصات مسیرها و گزارش کامل

---

## 7. ورودی نقشه

نمونه ورودی:

```
5 7
S..2..G
.LL.L..
..3...G
...L...
G....S.
```

معانی سلول‌ها:

* **S** = شروع
* **G** = حادثه / هدف
* **L** = چراغ راهنمایی با چرخه ۲۰ ثانیه
* **عدد** = هزینه عبور
* **.** = زمین خالی با هزینه زیاد (۳،۵،۱۰)

---

## 8. نحوه اجرای هر سناریو

### **سناریوی ۱ (UCS):**

```
python scenario1_uninformed.py
```

### **سناریوی ۲ (A*):**

```
python scenario2_astar.py
```

### **سناریوی ۳ (Genetic Algorithm):**

```
python scenario3_genetic.py
```

---

## 9. جمع‌بندی

این پروژه یک سیستم کامل برای مسیریابی آمبولانس‌ها در سناریوهای مختلف است:

* سناریوی ۱ → جستجوی بدون هیوریستیک (UCS)
* سناریوی ۲ → جستجوی هوشمند با A* و هیوریستیک MST
* سناریوی ۳ → بهینه‌سازی تخصیص چند آمبولانس با GA

هر بخش به خوبی ماژولار بوده و قابلیت گسترش دارد، به‌ویژه در سناریوی سوم که می‌توان operatorها و هیوریستیک‌های جدید اضافه کرد.
